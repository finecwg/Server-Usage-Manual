# 다중 노드 및 다중 GPU 활용 방법

# 7.5. 다중 노드 및 다중 GPU 활용 방법

Slurm 작업 스케줄러를 사용하면 다중 노드와 다중 GPU를 활용하여 대규모 병렬 작업을 효율적으로 실행할 수 있습니다. 이 문서에서는 Slurm에서 다중 노드와 다중 GPU를 사용하는 방법에 대해 자세히 설명하겠습니다.

## 다중 노드 작업 실행

Slurm에서 다중 노드 작업을 실행하려면 작업 제출 시 필요한 노드 수와 각 노드에서 사용할 CPU 코어 수를 지정해야 합니다.

```bash
#!/bin/bash
#SBATCH --job-name=multi_node_job
#SBATCH --nodes=4
#SBATCH --ntasks-per-node=16
#SBATCH --time=01:00:00

srun my_parallel_program

```

위의 작업 스크립트에서는 다음과 같은 옵션을 사용하여 다중 노드 작업을 구성합니다:

- `-nodes`: 작업에 할당할 노드 수를 지정합니다. 위 예시에서는 4개의 노드를 요청합니다.
- `-ntasks-per-node`: 각 노드에서 실행할 태스크(프로세스) 수를 지정합니다. 위 예시에서는 노드당 16개의 태스크를 실행합니다.

`srun` 명령을 사용하여 병렬 프로그램을 실행합니다. Slurm은 요청된 노드 수와 태스크 수에 따라 작업을 분산 실행합니다.

## 다중 GPU 작업 실행

Slurm에서 다중 GPU 작업을 실행하려면 작업 제출 시 필요한 GPU 수를 지정해야 합니다. 이를 위해 `--gres` 옵션을 사용합니다.

```bash
#!/bin/bash
#SBATCH --job-name=multi_gpu_job
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=1
#SBATCH --gres=gpu:4
#SBATCH --time=02:00:00

srun my_gpu_program

```

위의 작업 스크립트에서는 다음과 같은 옵션을 사용하여 다중 GPU 작업을 구성합니다:

- `-gres=gpu:4`: 작업에 할당할 GPU 수를 지정합니다. 위 예시에서는 4개의 GPU를 요청합니다.

`srun` 명령을 사용하여 GPU 프로그램을 실행합니다. Slurm은 요청된 GPU 수에 따라 작업을 GPU에 할당합니다.

## 다중 노드 및 다중 GPU 작업 실행

다중 노드와 다중 GPU를 함께 사용하여 대규모 병렬 작업을 실행할 수 있습니다.

```bash
#!/bin/bash
#SBATCH --job-name=multi_node_gpu_job
#SBATCH --nodes=2
#SBATCH --ntasks-per-node=1
#SBATCH --gres=gpu:2
#SBATCH --time=04:00:00

srun my_parallel_gpu_program

```

위의 작업 스크립트에서는 다음과 같은 옵션을 사용하여 다중 노드 및 다중 GPU 작업을 구성합니다:

- `-nodes=2`: 작업에 할당할 노드 수를 지정합니다. 위 예시에서는 2개의 노드를 요청합니다.
- `-ntasks-per-node=1`: 각 노드에서 실행할 태스크 수를 지정합니다. 위 예시에서는 노드당 1개의 태스크를 실행합니다.
- `-gres=gpu:2`: 각 노드에 할당할 GPU 수를 지정합니다. 위 예시에서는 노드당 2개의 GPU를 요청합니다.

`srun` 명령을 사용하여 병렬 GPU 프로그램을 실행합니다. Slurm은 요청된 노드 수와 GPU 수에 따라 작업을 분산 실행합니다.

## 추가 고려 사항

- 다중 노드 및 다중 GPU 작업을 실행할 때는 프로그램이 병렬 처리 및 GPU 활용에 최적화되어 있는지 확인해야 합니다.
- 작업 스크립트에서 `-cpus-per-task` 옵션을 사용하여 각 태스크에 할당할 CPU 코어 수를 지정할 수 있습니다. 이는 노드 내에서 태스크 간의 리소스 할당을 조정하는 데 유용합니다.
- `-exclusive` 옵션을 사용하여 노드를 독점적으로 사용할 수 있습니다. 이렇게 하면 다른 작업이 해당 노드에서 실행되지 않습니다.
- GPU 작업을 실행할 때는 CUDA, OpenCL 등의 GPU 프로그래밍 프레임워크와 관련 라이브러리가 노드에 올바르게 설치 및 구성되어 있는지 확인해야 합니다.

## 결론

이 문서에서는 Slurm 작업 스케줄러에서 다중 노드와 다중 GPU를 활용하는 방법에 대해 설명했습니다. 작업 제출 시 적절한 옵션을 사용하여 노드 수, 노드당 태스크 수, GPU 수 등을 지정할 수 있습니다. 이를 통해 대규모 병렬 작업과 GPU 가속 작업을 효율적으로 실행할 수 있습니다. 다중 노드 및 다중 GPU 활용을 위해서는 프로그램의 최적화와 필요한 라이브러리 및 프레임워크의 설치도 고려해야 합니다. Slurm의 기능을 활용하여 HPC 클러스터의 자원을 효과적으로 활용할 수 있습니다.